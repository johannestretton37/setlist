webpackJsonp([1],{ALyB:function(t,e){},AqYa:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQwIDc5LjE2MDQ1MSwgMjAxNy8wNS8wNi0wMTowODoyMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChNYWNpbnRvc2gpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkRGRjMxMkU1RTQyRDExRTc5REMzRjFEMUM4QUM1QzhFIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkRGRjMxMkU2RTQyRDExRTc5REMzRjFEMUM4QUM1QzhFIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6REZGMzEyRTNFNDJEMTFFNzlEQzNGMUQxQzhBQzVDOEUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6REZGMzEyRTRFNDJEMTFFNzlEQzNGMUQxQzhBQzVDOEUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6GXrU1AAAAEElEQVR42mL4//8/A0CAAQAI/AL+26JNFgAAAABJRU5ErkJggg=="},EmOQ:function(t,e){},FfzF:function(t,e){},L8PN:function(t,e){},NHnr:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s("7+uW"),i=s("Dd8w"),r=s.n(i),o={name:"Song",props:["song","order"],methods:{updateItemPositions:function(){for(var t=document.getElementsByClassName("song-item-container"),e={},s=0;s<t.length;s++){var n=t[s],i=n.id,r=n.dataset.order;if(i){var o=n.getBoundingClientRect();e[n.id]={order:r,top:o.top,bottom:o.bottom,height:o.height}}}this.$store.commit("itemPositions",e)},positionPlaceholder:function(t){var e=document.getElementById("draggedItemPlaceholder");if(e){var s=t.y-.5*e.getBoundingClientRect().height+window.pageYOffset;e.style.transform="translateY("+s+"px)"}},deleteSong:function(t){this.$store.commit("deleteSong",t.target.dataset.id)},selectItem:function(t){this.$store.commit("draggedItem",this.song),this.positionPlaceholder(t),this.updateItemPositions()},moveItem:function(t){for(var e in this.positionPlaceholder(t),this.itemPositions){var s=this.itemPositions[e];if(t.y>s.top&&t.y<s.bottom){var n=t.y<s.top+.5*s.height;this.$store.commit("draggingOverItemId",{id:e,targetSlot:n?parseInt(s.order,10)-1:parseInt(s.order,10),slotPre:n,slotPost:!n});break}}},dropItem:function(t){var e=this;this.$store.commit("draggedItemEnd"),setTimeout(function(){var t=document.getElementsByClassName("wasMoved")[0];t&&t.classList.remove("wasMoved"),e.$store.commit("itemWasMoved")},400)},handleTouchStart:function(t){var e=this;if(1==t.touches.length){this.distance=0,this.startTime=(new Date).getTime(),this.startX=t.touches[0].clientX,this.startY=t.touches[0].clientY;var s=this.pointFromEvent(t);this.longPressTimer=setTimeout(function(){e.selectItem(s)},500)}},handleTouchMove:function(t){if(this.isDragging)t.preventDefault(),this.moveItem(this.pointFromEvent(t));else{var e=this.startX-t.touches[0].clientX,s=this.startY-t.touches[0].clientY;Math.abs(s)>Math.abs(e)&&console.log("scroll"),Math.abs(s)<Math.abs(e)&&(e>50?t.currentTarget.parentNode.classList.add("delete"):e<-50?t.currentTarget.parentNode.classList.remove("delete"):console.log("Swiped left/right",e,"px")),Math.abs(s)>50&&this.cancelLongPress()}},handleTouchEnd:function(t){this.cancelLongPress(),this.isDragging&&(t.preventDefault(),this.dropItem(t))},cancelLongPress:function(){this.longPressTimer&&clearTimeout(this.longPressTimer),console.log("clearing longPressTimer")},handleDragStart:function(t){var e=document.getElementById("dragImg");e.style.display="block",e.style.top=window.pageYOffset+"px",t.dataTransfer.setDragImage(e,0,0),t.dataTransfer.dropEffect="move",this.selectItem(this.pointFromEvent(t))},handleDrag:function(t){this.moveItem(this.pointFromEvent(t))},handleDragEnd:function(t){this.dropItem(t)},pointFromEvent:function(t){var e=t.touches?t.touches[0]:t;return{x:e.clientX,y:e.clientY}}},computed:{slotClasses:function(){return{blankSpot:null!=this.draggedItem&&this.song.id===this.draggedItem.id,draggingOver:this.draggingOverThis,targetSlotPre:this.targetSlot===this.order-1,targetSlotPost:this.targetSlot===this.order,draggable:void 0!==this.order,wasMoved:this.wasMoved===this.song.id}},duration:function(){var t=Math.floor(this.song.duration/60),e=this.song.duration%60;return e<10&&(e="0"+e),t+":"+e},draggedItem:function(){return this.$store.state.draggedItem},draggingOverThis:function(){return this.draggingOverItemId===this.song.id},draggingOverItemId:function(){return this.$store.state.draggingOverItemId},targetSlot:function(){return this.$store.state.targetSlot},wasMoved:function(){return this.$store.state.wasMoved},itemPositions:function(){return this.$store.state.itemPositions},isDragging:function(){return this.$store.state.isDragging},isScrolling:function(){return this.$store.state.isScrolling}}},a={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("li",[s("div",{staticClass:"song-item-container",class:t.slotClasses,attrs:{id:t.song.id,"data-order":t.order,draggable:void 0!==t.order},on:{dragstart:t.handleDragStart,drag:t.handleDrag,dragend:t.handleDragEnd,contextmenu:function(t){return t.preventDefault()},touchstart:t.handleTouchStart,touchmove:t.handleTouchMove,touchend:t.handleTouchEnd,touchcancel:t.handleTouchEnd}},[s("div",{directives:[{name:"show",rawName:"v-show",value:1==t.order,expression:"order == 1"}],staticClass:"slot preSlot"}),t._v(" "),s("span",{staticClass:"songInfo order"},[t._v("\n        "+t._s(t.order)+"\n      ")]),t._v(" "),s("span",{staticClass:"songInfo artist left"},[t._v("\n        "+t._s(t.song.artist)+"\n      ")]),t._v(" "),s("span",{staticClass:"songInfo title"},[t._v("\n        "+t._s(t.song.title)+"\n      ")]),t._v(" "),s("span",{staticClass:"songInfo duration"},[t._v("\n        "+t._s(t.duration)+"\n      ")]),t._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:void 0!==t.order,expression:"order !== undefined"}],staticClass:"slot postSlot"})]),t._v(" "),s("div",{staticClass:"delete-button",attrs:{"data-id":t.song.id},on:{click:t.deleteSong}},[t._v("\n    DELETE\n  ")])])},staticRenderFns:[]};var c=s("VU/8")(o,a,!1,function(t){s("gA3L")},"data-v-6eca126a",null).exports,l=s("Zrlr"),u=s.n(l),d=s("i81k"),g=s.n(d),h=function t(e,s,n,i,r){var o=this;u()(this,t),this.isValid=function(){return""!==o.title&&void 0!==o.id},this.isEqual=function(t){return o.index===t.index&&o.title===t.title&&o.artist===t.artist&&o.duration===t.duration&&o.isEncore===t.isEncore},this.toStorage=function(){return{index:o.index,title:o.title,artist:o.artist,duration:o.duration,isEncore:o.isEncore}},this.id=g()(),this.index=e,this.title=s,this.artist=n,this.duration=i,this.isEncore=r||!1,this.isEncoreDivider=!1};h.songFromDocData=function(t,e){var s=new h(t.index,t.title,t.artist,t.duration,t.isEncore);return s.id=e,s};var m=h,p={name:"SongsTotal",props:["songs"],components:{Song:c},computed:{total:function(){var t=0,e=0;return this.songs.forEach(function(s){t++,e+=s.duration}),{title:t+" songs in total",duration:e}}}},f={render:function(){var t=this.$createElement;return(this._self._c||t)("Song",{attrs:{song:this.total}})},staticRenderFns:[]},v={name:"Songs",components:{Song:c,SongsTotal:s("VU/8")(p,f,!1,null,null,null).exports},props:["songs"],computed:{draggedItemPlaceholder:function(){var t=new m(this.$store.state.draggedItem.index,this.$store.state.draggedItem.title,this.$store.state.draggedItem.artist,this.$store.state.draggedItem.duration);return t},isDragging:function(){return this.$store.state.isDragging},encoreStart:function(){return this.$store.getters.setList.encoreStart||-1}}},S={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"songs-container"},[s("div",{staticClass:"songs"},[s("transition-group",{staticClass:"song-items-container",attrs:{tag:"ul",name:"rearrange"}},[t._l(t.songs,function(e,n){return[s("Song",{key:e.index,attrs:{order:n+1,song:e}}),t._v(" "),t.encoreStart==n?s("div",{key:"encoreDivider"+n,staticClass:"divider encore"}):t._e()]}),t._v(" "),s("div",{key:"totalDivider",staticClass:"divider total"}),t._v(" "),t.songs.length>0?s("SongsTotal",{key:"total",attrs:{songs:t.songs}}):t._e()],2),t._v(" "),t.isDragging?s("div",{attrs:{id:"draggedItemPlaceholder"}},[s("Song",{attrs:{song:t.draggedItemPlaceholder}})],1):t._e()],1)])},staticRenderFns:[]};var L=s("VU/8")(v,S,!1,function(t){s("FfzF")},"data-v-37ae1ffd",null).exports,b=s("NYxO"),w=function t(e,s,n,i){u()(this,t),this.title=e||"Untitled SetList",this.subtitle=s||"",this.songs=n||[],this.encoreStart=i||-1};w.setListFromDocData=function(t,e){var s=new w(t.title,t.subtitle,t.songs,t.encoreStart);return s.id=e,s};var I=w,y={name:"SetList",components:{Songs:L},computed:r()({},Object(b.b)(["setList"])),data:function(){return{idleTimer:null,newSetListTitle:"",newSongTitle:"",newSongArtist:"",newSongDuration:""}},methods:{handleInput:function(t){this.startIdleTimer(t.target);var e=t.target.value;switch(t.target.dataset.model){case"songTitle":e.length>2&&(console.log("Searching for",e),this.stopIdleTimer())}},handleBlur:function(t){this.stopIdleTimer()},startIdleTimer:function(t){var e=this;this.stopIdleTimer(),this.idleTimer=setTimeout(function(){e.idleTimer&&(e.stopIdleTimer(),console.log("User idle, performing search for:",t.value))},2e3)},stopIdleTimer:function(){clearTimeout(this.idleTimer)},addSong:function(){var t=new m(this.setList.songs.length,this.newSongTitle,this.newSongArtist,this.toSeconds(this.newSongDuration));t.id=""+this.setList.songs.length,t.isValid()&&(this.$store.commit("addSong",{newSong:t,persist:!0}),this.resetForm())},resetForm:function(){this.newSetListTitle="",this.newSongTitle="",this.newSongArtist="",this.newSongDuration="",document.activeElement.blur()},onEnter:function(t){document.querySelector(".new-song-form").style.height=t.getBoundingClientRect().height+"px"},afterEnter:function(t){t.querySelector("input[autofocus]").focus()},toSeconds:function(t){if(""===t)return 0;var e=t.split(/[:,.]/gi);return e.length<=1?parseInt(t,10):60*parseInt(e[0].trim(),10)+parseInt(e[1].trim(),10)},notEmpty:function(t){return{empty:""===t}}}},x={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"setlist-container"},[t.setList?[s("h2",[t._v(t._s(t.setList.title))]),t._v(" "),s("p",[s("i",[t._v(t._s(t.setList.subtitle))])]),t._v(" "),s("Songs",{attrs:{songs:t.setList.songs}})]:t._e()],2),t._v(" "),s("div",{staticClass:"new-song-form"},[s("form",{key:"addNewSong",staticClass:"add-song-form",on:{submit:function(e){e.preventDefault(),t.addSong(e)}}},[s("h3",{staticStyle:{"grid-area":"header"}},[t._v("Add new song")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.newSongTitle,expression:"newSongTitle"}],staticClass:"center",staticStyle:{"grid-area":"title"},attrs:{type:"text","data-model":"songTitle",autofocus:"",placeholder:"Song Title"},domProps:{value:t.newSongTitle},on:{input:[function(e){e.target.composing||(t.newSongTitle=e.target.value)},t.handleInput]}}),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.newSongDuration,expression:"newSongDuration"}],staticClass:"center duration",staticStyle:{"grid-area":"duration"},attrs:{type:"text","data-model":"songDuration",placeholder:"0:00"},domProps:{value:t.newSongDuration},on:{input:[function(e){e.target.composing||(t.newSongDuration=e.target.value)},t.handleInput]}}),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.newSongArtist,expression:"newSongArtist"}],staticClass:"center",staticStyle:{"grid-area":"artist"},attrs:{type:"text","data-model":"songArtist",placeholder:"Artist (optional)"},domProps:{value:t.newSongArtist},on:{input:[function(e){e.target.composing||(t.newSongArtist=e.target.value)},t.handleInput]}}),t._v(" "),s("button",{staticStyle:{"grid-area":"submit"}},[t._v("Add song to list")])])])])},staticRenderFns:[]};var _=s("VU/8")(y,x,!1,function(t){s("L8PN")},null,null).exports,T={name:"Scroller",data:function(){return{scrollTimer:null}},methods:{handleScroll:function(t){var e=this;null===this.scrollTimer&&(this.$store.commit("scroll",!0),this.scrollTimer=setTimeout(function(){clearTimeout(e.scrollTimer),e.scrollTimer=null,e.$store.commit("scroll",!1)},700))}},created:function(){window.addEventListener("scroll",this.handleScroll)},destroyed:function(){window.removeEventListener("scroll",this.handleScroll)}},E={render:function(){var t=this.$createElement;return(this._self._c||t)("div")},staticRenderFns:[]},A=s("VU/8")(T,E,!1,null,null,null).exports;const D={apiKey:"AIzaSyAU9rtPJJWLXR3nB0Az-xCjToOOq8mPfLg",authDomain:"jaybo-setlister.firebaseapp.com",databaseURL:"https://jaybo-setlister.firebaseio.com",projectId:"jaybo-setlister",storageBucket:"jaybo-setlister.appspot.com",messagingSenderId:"459478069088"};var C=s("Sazm"),k=s.n(C),R=s("2ahc"),N=s.n(R),F={name:"app",components:{SetList:_,Songs:L,Scroller:A}},M={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var U=s("VU/8")(F,M,!1,function(t){s("eONf")},null,null).exports,P=s("/ocq"),O=s("woOf"),G=s.n(O),V=s("+6Bu"),z=s.n(V),B=s("fZjL"),W=s.n(B),Y=s("Xxa5"),$=s.n(Y),j=s("bOdI"),Z=s.n(j),Q=s("exGp"),J=s.n(Q),X=s("d7EF"),H=s.n(X),q=s("W3Iv"),K=s.n(q),tt=s("//Fk"),et=s.n(tt),st=function t(e){var s,n,i,r=this;u()(this,t),this.getOrCreateUser=(s=J()($.a.mark(function t(e){var s,n,i,o,a;return $.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=k.a.firestore(),t.prev=1,t.next=5,s.collection("users");case 5:return n=t.sent,t.next=9,n.doc(i.uid);case 9:return i=t.sent,t.next=13,i.get();case 13:if(!(o=t.sent).exists){t.next=20;break}return a=o.data(),t.abrupt("return",a);case 20:s.collection("users").doc(i.uid).set(i).then(function(){return i});case 21:t.next=27;break;case 23:t.prev=23,t.t0=t.catch(1),console.log("error"),console.log(t.t0);case 27:case"end":return t.stop()}},t,r,[[1,23]])})),function(t){return s.apply(this,arguments)}),this.getCollectionRef=(n=J()($.a.mark(function t(e){return $.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new et.a(function(){var t=J()($.a.mark(function t(s){var n,i;return $.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=k.a.firestore(),t.prev=1,t.next=4,n.collection(e);case 4:return i=t.sent,t.abrupt("return",s(i));case 8:return t.prev=8,t.t0=t.catch(1),t.abrupt("return",s(!1));case 11:case"end":return t.stop()}},t,r,[[1,8]])}));return function(e){return t.apply(this,arguments)}}()));case 1:case"end":return t.stop()}},t,r)})),function(t){return n.apply(this,arguments)}),this.inviteCollaborator=function(t,e,s){return new et.a((n=J()($.a.mark(function n(i,o){var a,c,l;return $.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(e+" invites "+t+" to setlist "+s),n.prev=1,n.next=4,r.getCollectionRef("invitations");case 4:return a=n.sent,n.next=7,a.where("inviter","==",e).get();case 7:if(c=n.sent,l=!1,c.forEach(function(e){var n=e.data();n.setListId===s&&n.invited===t&&(l=!0)}),!l){n.next=14;break}return n.abrupt("return",o(t+" is already invited to this SetList"));case 14:return n.next=16,a.doc().set({invited:t,inviter:e,setListId:s});case 16:return n.sent,n.abrupt("return",i(t+" successfully invited"));case 18:n.next=23;break;case 20:return n.prev=20,n.t0=n.catch(1),n.abrupt("return",o(n.t0));case 23:case"end":return n.stop()}},n,r,[[1,20]])})),function(t,e){return n.apply(this,arguments)}));var n},this.getUsersLastSetListId=function(t){return new et.a((e=J()($.a.mark(function e(s){var n,i,o,a;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getCollectionRef("users");case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return",s(void 0));case 5:return e.prev=5,e.next=8,n.doc(t);case 8:return i=e.sent,e.next=11,i.get();case 11:if(!(o=e.sent).exists){e.next=17;break}return a=o.data(),e.abrupt("return",s(a.currentSetListId));case 17:return e.abrupt("return",s(void 0));case 18:e.next=23;break;case 20:return e.prev=20,e.t0=e.catch(5),e.abrupt("return",s(void 0));case 23:case"end":return e.stop()}},e,r,[[5,20]])})),function(t){return e.apply(this,arguments)}));var e},this.getSetLists=(i=J()($.a.mark(function t(e){var s;return $.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.getCollectionRef("setlists");case 2:if(s=t.sent){t.next=5;break}return t.abrupt("return",void 0);case 5:return t.abrupt("return",s.where("users."+e,"==",!0).get().then(function(){var t=J()($.a.mark(function t(e){var s,n;return $.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s={},n=[],e.forEach(function(t){var e=t.data(),i=I.setListFromDocData(e,t.id),r=t.ref.collection("songs").get().then(function(t){t.forEach(function(t){var e=t.data(),s=m.songFromDocData(e,t.id);i.songs.push(s)}),s[i.id]=i});n.push(r)}),t.next=5,et.a.all(n);case 5:return t.abrupt("return",s);case 6:case"end":return t.stop()}},t,r)}));return function(e){return t.apply(this,arguments)}}()));case 6:case"end":return t.stop()}},t,r)})),function(t){return i.apply(this,arguments)}),this.persistCurrentSetListId=function(t,e){return new et.a((s=J()($.a.mark(function s(n){var i;return $.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,r.getCollectionRef("users");case 2:return i=s.sent,s.next=5,i.doc(t).set({currentSetListId:e},{merge:!0});case 5:return s.abrupt("return",n());case 6:case"end":return s.stop()}},s,r)})),function(t){return s.apply(this,arguments)}));var s},this.deleteCurrentSetListId=function(t){return new et.a((e=J()($.a.mark(function e(s){var n;return $.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.getCollectionRef("users");case 2:return n=e.sent,e.abrupt("return",n.doc(t).update({currentSetListId:k.a.firestore.FieldValue.delete()}));case 4:case"end":return e.stop()}},e,r)})),function(t){return e.apply(this,arguments)}));var e},this.persistSetList=function(t,e){var s,n=["title","subtitle","users"];return new et.a((s=J()($.a.mark(function s(i){var o,a,c,l,u,d,g,h;return $.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return console.log("PERSISTING",t),console.table(e),s.next=4,r.getCollectionRef("setlists");case 4:if(o=s.sent){s.next=7;break}return s.abrupt("return",i(void 0));case 7:if(a={},K()(e).forEach(function(t){var e=H()(t,2),s=e[0],i=e[1];if(n.includes(s))switch(s){case"users":console.log("ignore users for now");break;default:console.log(s,"modified locally to ->",i),a[s]=i}}),c=k.a.firestore(),(l=c.batch()).set(o.doc(t),a,{merge:!0}),!e.songs){s.next=26;break}return s.next=15,o.doc(t).collection("songs").orderBy("index").get();case 15:u=s.sent,d=[],u.forEach(function(t){var e=t.data();e.id=t.id,d.push(e)}),console.log("storedSongs array:"),console.table(d),g=0,d.forEach(function(s){var n=e.songs[g];if(n){if(console.log("comparing stored to local:"),console.table([s,n]),s.id!==n.id||s.index!==n.index){console.log("The above are not the same"),console.log("batch.DELETE stored song with key",g);var i=o.doc(t).collection("songs").doc(""+g);l.delete(i);var r=n.toStorage();r.index=g,console.log("batch.ADD localSongSerialized",r),l.set(i,r)}g++}}),console.log("Looped through storedSongs, i =",g),(h=e.songs.slice(g)).length>0?(console.log(h.length,"songs were added:",h),h.forEach(function(e,s){console.log("Add song with index",s+g);var n=e.toStorage();n.index=s+g;var i=o.doc(t).collection("songs").doc(""+(s+g));l.set(i,n)})):console.log("No more songs...",e.songs);case 26:return s.abrupt("return",l.commit());case 27:case"end":return s.stop()}},s,r)})),function(t){return s.apply(this,arguments)}))},this.watchSetList=function(t){return r.getCollectionRef("setlists").then(function(e){void 0!==r.unsubscribeSetListWatch&&(console.log("unsubscribing from setlist watch"),r.unsubscribeSetListWatch()),r.unsubscribeSetListWatch=e.doc(t).onSnapshot(function(t){if(t.metadata.fromCache)console.log("[SETLIST] local update only");else{console.log("[SETLIST]  === UPDATE UI ===");var e=t.data(),s=I.setListFromDocData(e,t.id);console.log(s),r.store.commit("editSetList",{editedSetList:s,persist:!1})}}),void 0!==r.unsubscribeSongsWatch&&(console.log("unsubscribing from songs watch"),r.unsubscribeSongsWatch()),r.unsubscribeSongsWatch=e.doc(t).collection("songs").onSnapshot(function(t){t.docChanges.forEach(function(t){if(t.doc.metadata.fromCache)console.log("[SONGS] local update only");else{if(console.log("[SONGS]  === UPDATE UI ==="),"added"===t.type){console.log("New song: ",t.doc.data());var e=t.doc.data(),s=m.songFromDocData(e,t.doc.id);console.log("addSong",s),r.store.commit("addSong",{newSong:s,persist:!1})}if("modified"===t.type){var n=t.doc.data(),i=m.songFromDocData(n,t.doc.id);console.log("Modified song: ",i),r.store.commit("editSong",{updatedSong:i,persist:!1})}if("removed"===t.type){var o=t.doc.data(),a=m.songFromDocData(o,t.doc.id);console.log("Removed song: ",a),r.store.commit("deleteSong",{id:a.id,persist:!1})}}})})})},this.store=e,this.unsubscribeSetListWatch,this.unsubscribeSongsWatch},nt=this;n.a.use(b.a);var it,rt,ot,at,ct=new st(lt),lt=new b.a.Store({state:{user:void 0,setLists:{},setListId:"",draggedItem:null,draggingOverItemId:"",itemPositions:{},targetSlot:-1,wasMoved:"",isDragging:!1,isScrolling:!1,notifications:[],displayNotification:!1},getters:{setList:function(t){return t.setLists[t.setListId]||null},setLists:function(t){return t.setLists||{}}},actions:{createSetList:(at=J()($.a.mark(function t(e,s){var n,i,r,o,a,c=e.state,l=e.commit;return $.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ct.getCollectionRef("setlists");case 2:return n=t.sent,t.next=5,n.add({title:s.title,subtitle:s.subtitle,users:Z()({},c.user.uid,!0)});case 5:return i=t.sent,t.next=8,i.get();case 8:r=t.sent,o=r.data(),a=i.id,l("loadSetList",o),l("updateSetListId",a);case 13:case"end":return t.stop()}},t,nt)})),function(t,e){return at.apply(this,arguments)}),getUserSetLists:(ot=J()($.a.mark(function t(e){var s,n,i=e.state,r=e.commit;return $.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ct.getSetLists(i.user.uid);case 2:if(s=t.sent,!(W()(s).length>0)){t.next=13;break}return t.next=6,ct.getUsersLastSetListId(i.user.uid);case 6:(n=t.sent)||(n=W()(s)[0])&&(s[n]?ct.persistCurrentSetListId(i.user.uid,n):ct.deleteCurrentSetListId(i.user.uid)),r("loadSetLists",s),r("updateSetListId",n),ct.watchSetList(n),t.next=14;break;case 13:console.warn("No setlists found");case 14:case"end":return t.stop()}},t,nt)})),function(t){return ot.apply(this,arguments)}),openSetList:(rt=J()($.a.mark(function t(e,s){e.state;var n=e.commit;return $.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n("closeSetList"),t.next=3,ct.watchSetList(s);case 3:n("updateSetListId",s);case 4:case"end":return t.stop()}},t,nt)})),function(t,e){return rt.apply(this,arguments)}),inviteCollaboratorToSetList:(it=J()($.a.mark(function t(e,s){var n,i=e.state,r=e.commit,o=s.setListId,a=s.invitedEmail;return $.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,ct.inviteCollaborator(a,i.user.uid,o);case 3:n=t.sent,console.log("Invitation complete",n),r("displayNotification",{title:"Invitation sent",message:n}),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.error(t.t0);case 11:case"end":return t.stop()}},t,nt,[[0,8]])})),function(t,e){return it.apply(this,arguments)})},mutations:{displayNotification:function(t,e){t.notifications.push(e),t.displayNotification=!0},loggedIn:function(t,e){t.user=e},loggedOut:function(t){t.user=void 0,t.setLists={},t.setListId=""},loadSetLists:function(t,e){t.setLists=e},loadSetList:function(t,e){t.setLists[e.id]=e},editSetList:function(t,e){var s=e.editedSetList,n=(e.persist,this.getters.setList),i=(s.songs,z()(s,["songs"]));G()(n,i)},closeSetList:function(t){t.setListId=null},updateSetListId:function(t,e){t.setListId=e},addSong:function(t,e){var s=e.newSong,n=e.persist;if(console.log("Will maybe add song",s,"persist =",n),n)this.getters.setList.songs.splice(s.index,0,s),persistSetList(t.setListId,{songs:this.getters.setList.songs});else{var i=this.getters.setList.songs[s.index];void 0!==i&&i.isEqual(s)||this.getters.setList.songs.splice(s.index,0,s)}},editSong:function(t,e){var s=e.updatedSong;if(e.persist)this.getters.setList.songs.splice(s.index,1,s),persistSetList(t.setListId,{songs:this.getters.setList.songs});else{var n=this.getters.setList.songs[s.index];void 0!==n&&n.isEqual(s)||this.getters.setList.songs.splice(s.index,1,s)}},deleteSong:function(t,e){var s=e.id;e.persist?(this.getters.setList.songs=this.getters.setList.songs.filter(function(t){return t.id!==s}),persistSetList(t.setListId,{songs:this.getters.setList.songs})):void 0!==this.getters.setList.songs.find(function(t){return t.id===s})&&(this.getters.setList.songs=this.getters.setList.songs.filter(function(t){return t.id!==s}))},draggedItemEnd:function(t){if(t.draggedItem&&t.draggedItem.id!==t.draggingOverItemId){var e=ut(this.getters.setList,t.draggedItem.id);this.getters.setList.songs.splice(e,1);var s=e>t.targetSlot?0:-1;this.getters.setList.songs.splice(t.targetSlot+s,0,t.draggedItem),t.wasMoved=t.draggedItem.id}t.draggedItem=null,t.isDragging=!1,t.draggingOverItemId="",t.targetSlot=-1,persistSetList(t.setListId,{songs:this.getters.setList.songs})},scroll:function(t,e){t.isScrolling=e},draggedItem:function(t,e){t.draggedItem=e,t.isDragging=!0,t.wasMoved=""},itemWasMoved:function(t){t.wasMoved=""},draggingOverItemId:function(t,e){t.draggingOverItemId=e.id,t.targetSlot=e.targetSlot},itemPositions:function(t,e){t.itemPositions=e}}}),ut=function(t,e){return t.songs.findIndex(function(t){return t.id===e})},dt=lt,gt={name:"Notifications",computed:r()({},Object(b.c)(["notifications","displayNotification"])),data:function(){return{displayTimer:null}},methods:{startDisplayTimer:function(t){var e=this;this.stopIdleTimer(),this.displayTimer=setTimeout(function(){e.displayTimer&&(e.stopDisplayTimer(),console.log("User idle, performing search for:",t.value))},5e3)},stopDisplayTimer:function(){clearTimeout(this.displayTimer)}}},ht={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"notifications-container"},[s("div",{staticClass:"notifications"},t._l(t.notifications,function(e){return s("div",{key:e.id,staticClass:"notification"},[s("p",{staticClass:"title"},[t._v("Title")]),t._v(" "),s("p",{staticClass:"message"},[t._v("Message")])])}))])},staticRenderFns:[]};var mt=s("VU/8")(gt,ht,!1,function(t){s("wZny")},null,null).exports,pt=s("AqYa"),ft=s.n(pt),vt=(s("mtWM"),{name:"start",data:function(){return{showCreateSetListForm:!1,newSetListTitle:"",pixel:ft.a,spotifyLoginUrl:"https://accounts.spotify.com/authorize/?client_id=3bebc130ca7a4a8bbae269967a5e328e&response_type=code&redirect_uri=https%3A%2F%2Fjaybo-setlister.herokuapp.com%2Fsearch%2Fcallback%2F&scope=playlist-modify-public%20user-read-email&state=spotifylogin"}},methods:{logout:function(){k.a.auth().signOut()},createSetList:function(){var t=new I(this.newSetListTitle);this.$store.dispatch("createSetList",t),this.resetForm()},openSetList:function(t){this.$store.dispatch("openSetList",t)},shareSetList:function(t){var e=prompt("Enter email to your collaborator");this.$store.dispatch("inviteCollaboratorToSetList",{setListId:t,invitedEmail:e})},resetForm:function(){this.newSetListTitle="",document.activeElement.blur()}},computed:r()({},Object(b.c)(["user","setListId"]),Object(b.b)(["setLists"])),components:{SetList:_,Songs:L,Scroller:A,Notifications:mt}}),St={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"center-box"},[s("header",[s("h1",[t._v("SetLister")]),t._v(" "),s("p",[t._v("[BETA Version]")]),t._v(" "),s("div",{staticClass:"avatar"},[t.user?s("p",[s("b",[t._v(t._s(t.user.name))]),t._v(" "),t.user?s("img",{staticStyle:{width:"30px","border-radius":"50%"},attrs:{src:t.user.avatar}}):t._e()]):t._e(),t._v(" "),t.user?s("button",{on:{click:function(e){e.preventDefault(),t.logout(e)}}},[t._v("Log out")]):t._e()])]),t._v(" "),t.user?s("div",[s("p",{staticStyle:{width:"70%",margin:"0.5em auto"}},[t._v("If you have Spotify Premium, you'll be able to save your SetList as a Spotify playlist.\n      You may also listen to music and search the Spotify library. \n    ")]),t._v(" "),s("a",{attrs:{href:t.spotifyLoginUrl}},[t._v("Login to Spotify")])]):t._e(),t._v(" "),s("hr"),t._v(" "),s("Scroller"),t._v(" "),Object.keys(t.setLists).length>0?s("div",{staticClass:"setlists-manager"},[t.showCreateSetListForm?t._e():s("button",{on:{click:function(e){t.showCreateSetListForm=!t.showCreateSetListForm}}},[t._v("Add new SetList")]),t._v(" "),t.showCreateSetListForm?s("form",{key:"createSetList",staticClass:"add-setlist-form",on:{submit:function(e){e.preventDefault(),t.createSetList(e)}}},[s("h3",{staticStyle:{"grid-area":"header"}},[t._v("New SetList")]),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.newSetListTitle,expression:"newSetListTitle"}],staticClass:"center",staticStyle:{"grid-area":"title"},attrs:{type:"text",autofocus:"",placeholder:"Name"},domProps:{value:t.newSetListTitle},on:{input:function(e){e.target.composing||(t.newSetListTitle=e.target.value)}}}),t._v(" "),s("button",{staticStyle:{"grid-area":"submit"}},[t._v("Create SetList")]),t._v(" "),s("button",{staticStyle:{"grid-area":"cancel"},on:{click:function(e){e.preventDefault(),t.showCreateSetListForm=!t.showCreateSetListForm}}},[t._v("Cancel")])]):t._e(),t._v(" "),s("ul",t._l(t.setLists,function(e,n){return s("li",{key:n},[t.setListId!==n?s("button",{on:{click:function(e){t.openSetList(n)}}},[t._v("Open "+t._s(e.title))]):t._e(),t._v(" "),s("button",{on:{click:function(e){t.shareSetList(n)}}},[t._v("Share "+t._s(e.title))])])}))]):t._e(),t._v(" "),s("hr"),t._v(" "),s("SetList"),t._v(" "),s("img",{attrs:{id:"dragImg",src:t.pixel}}),t._v(" "),s("Notifications")],1)},staticRenderFns:[]};var Lt=s("VU/8")(vt,St,!1,function(t){s("hod5")},"data-v-780163b5",null).exports,bt=(s("EmOQ"),{name:"login",components:{SetList:_,Songs:L,Scroller:A},data:function(){return{status:"Connecting to Google..."}},methods:{startLogIn:function(){this.status="Logging in. Please wait..."}},mounted:function(){var t=this,e=new N.a.auth.AuthUI(k.a.auth());k.a.auth().useDeviceLanguage(),e.start("#firebaseui-auth-container",{signInSuccessUrl:"/",signInOptions:[k.a.auth.GoogleAuthProvider.PROVIDER_ID],callbacks:{uiShown:function(){t.status="Log in with your Google account to start using the app"}},tosUrl:"/tos"})}}),wt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("section",{staticClass:"center-box"},[e("h1",[this._v("Log in")]),this._v(" "),e("p",[this._v(this._s(this.status))]),this._v(" "),e("div",{attrs:{id:"firebaseui-auth-container"},on:{mousedown:this.startLogIn}})])},staticRenderFns:[]};var It=s("VU/8")(bt,wt,!1,function(t){s("ALyB")},null,null).exports,yt=new P.a({mode:"history",routes:[{path:"/",component:Lt},{path:"/login",component:It}]});s("3VHS");n.a.use(P.a),n.a.config.productionTip=!1,new n.a({router:yt,store:dt,created:function(){var t=this;k.a.initializeApp(D),k.a.auth().onAuthStateChanged(function(e){e?(e.getIdToken().then(function(t){console.log("accessToken received...")}),dt.commit("loggedIn",{uid:e.uid,name:e.displayName,avatar:e.photoURL}),console.log("Logged in"),dt.dispatch("getUserSetLists"),t.$router.push("/")):(dt.commit("loggedOut"),console.log("Logged out"),t.$router.push("/login"))})},el:"#app",template:"<App/>",components:{App:U}})},eONf:function(t,e){},gA3L:function(t,e){},hod5:function(t,e){},lVK7:function(t,e,s){s("NHnr")},wZny:function(t,e){}},["lVK7"]);
//# sourceMappingURL=app.fcdde0c803f70fa9d109.js.map